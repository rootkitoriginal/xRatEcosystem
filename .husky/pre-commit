#!/usr/bin/env bash
. "$(dirname -- "$0")/_/husky.sh"

# FunÃ§Ã£o para executar comandos com mais resiliÃªncia
execute_command() {
  echo "ğŸ”„ Executando: $1"
  eval "$1" || {
    echo "âŒ Comando falhou: $1"
    echo "âš ï¸ Tentando continuar..."
    return 0  # Retorna 0 para nÃ£o interromper o commit
  }
}

# Run detect-secrets before committing
echo "ğŸ” Escaneando por segredos..."
detect-secrets scan --baseline .secrets.baseline || {
  echo "âš ï¸ PossÃ­veis segredos detectados!"
  echo "Execute: detect-secrets audit .secrets.baseline"
  exit 1
}

# Formatando arquivos
echo "âœ¨ Formatando arquivos..."
execute_command "npx prettier --write \"**/*.{md,yml,yaml}\""

# Executando lint:fix para backend
echo "ğŸ§¹ Executando lint:fix para o backend..."
execute_command "npm run lint:fix --workspace=backend"

# Executando lint:fix para frontend
echo "ğŸ§¹ Executando lint:fix para o frontend..."
execute_command "npm run lint:fix --workspace=frontend"

# Executando lint-staged para verificaÃ§Ãµes finais
echo "ğŸš€ Executando lint-staged para verificaÃ§Ãµes finais..."
execute_command "npx lint-staged"

echo "âœ… Pre-commit concluÃ­do com sucesso!"
