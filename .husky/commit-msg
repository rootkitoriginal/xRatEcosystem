#!/bin/bash

# Cores para melhor legibilidade
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat $COMMIT_MSG_FILE)

# Padr√£o de mensagem de commit baseado no Conventional Commits
# Refer√™ncia: https://www.conventionalcommits.org/
# Usar grep em vez de [[ =~ ]] para maior compatibilidade
echo -e "${BLUE}üîç Verificando formato da mensagem de commit...${NC}"

COMMIT_FIRST_LINE=$(echo "$COMMIT_MSG" | head -n 1)
if ! echo "$COMMIT_FIRST_LINE" | grep -E "^(feat|fix|docs|style|refactor|test|chore|perf|ci)(\(.+\))?!?: .+" > /dev/null; then
  echo -e "${RED}‚ùå Mensagem de commit inv√°lida:${NC} $COMMIT_MSG"
  echo -e "${YELLOW}A mensagem de commit deve seguir o padr√£o Conventional Commits:${NC}"
  echo -e "${GREEN}tipo(escopo opcional): descri√ß√£o${NC}"
  echo -e "${YELLOW}Onde tipo pode ser:${NC}"
  echo -e "${BLUE}feat${NC}: Nova funcionalidade"
  echo -e "${BLUE}fix${NC}: Corre√ß√£o de bug"
  echo -e "${BLUE}docs${NC}: Documenta√ß√£o"
  echo -e "${BLUE}style${NC}: Formata√ß√£o (sem altera√ß√£o de c√≥digo)"
  echo -e "${BLUE}refactor${NC}: Refatora√ß√£o de c√≥digo"
  echo -e "${BLUE}test${NC}: Adi√ß√£o ou corre√ß√£o de testes"
  echo -e "${BLUE}chore${NC}: Altera√ß√µes em processos de build, ferramentas, etc."
  echo -e "${BLUE}perf${NC}: Melhorias de performance"
  echo -e "${BLUE}ci${NC}: Altera√ß√µes na configura√ß√£o de CI"
  echo -e "${YELLOW}Exemplo:${NC} feat(auth): adicionar valida√ß√£o de token JWT"
  exit 1
fi

# Verificar comprimento da mensagem
TITLE=$(echo "$COMMIT_MSG" | head -n 1)
TITLE_LENGTH=${#TITLE}
if [ "$TITLE_LENGTH" -gt 100 ]; then
  echo -e "${RED}‚ùå A primeira linha da mensagem de commit √© muito longa ($TITLE_LENGTH > 100)${NC}"
  echo -e "${YELLOW}Por favor, mantenha a primeira linha com no m√°ximo 100 caracteres.${NC}"
  exit 1
fi

if [ "$TITLE_LENGTH" -lt 10 ]; then
  echo -e "${RED}‚ùå A primeira linha da mensagem de commit √© muito curta ($TITLE_LENGTH < 10)${NC}"
  echo -e "${YELLOW}Por favor, forne√ßa uma descri√ß√£o mais detalhada.${NC}"
  exit 1
fi

echo -e "${GREEN}‚úÖ Formato da mensagem de commit v√°lido!${NC}"
exit 0